"use strict";(self.webpackChunkgatsby_starter_default=self.webpackChunkgatsby_starter_default||[]).push([[589],{8526:function(e,t,n){var o=n(7294),r=n(6118),a=n(4854),l=n(1433);t.Z=e=>{let{children:t}=e;const{0:n,1:c}=(0,o.useState)(null),{0:i,1:s}=(0,o.useState)(!0);return(0,o.useEffect)((()=>{const e=(0,r.Aj)(l.I,(e=>{e?c(e):(0,a.navigate)("/login"),s(!1)}));return()=>e()}),[]),i?o.createElement("p",null,"Loading..."):n?t(n):null}},1070:function(e,t,n){n.r(t),n.d(t,{default:function(){return i}});var o=n(7294),r=n(5785);const a="makethemcall.me";var l=e=>{let{user:t}=e;const{0:l,1:c}=(0,o.useState)(null),{0:i,1:s}=(0,o.useState)(!1),{0:d,1:u}=(0,o.useState)("+12086962033"),{0:g,1:m}=(0,o.useState)([]),{0:p,1:h}=(0,o.useState)(null),{0:S,1:w}=(0,o.useState)(""),{0:b,1:k}=(0,o.useState)([]),{0:y,1:E}=(0,o.useState)([]),{0:f,1:C}=(0,o.useState)("");(0,o.useEffect)((()=>{"undefined"!=typeof window&&t&&n.e(423).then(n.bind(n,9423)).then((e=>{(async()=>{try{const n=await t.getIdToken(),o=await fetch("https://"+a+"/api/generate-token",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n},body:JSON.stringify({identity:"the_user_id"})});if(!o.ok)throw new Error("Failed to fetch token");const r=await o.json();console.log("ðŸ”‘ Token: "+r.token);const l=new e.Device(r.token);l.on("ready",(()=>console.log("âœ… Twilio.Device Ready!"))),l.on("error",(e=>console.log("âŒ Twilio.Device Error: "+e.message))),l.on("connect",(()=>s(!0))),l.on("disconnect",(()=>{s(!1),h(null)})),l.on("incoming",(e=>{console.log("ðŸ“ž Incoming call detected:",e),h(e)})),c(l)}catch(n){console.log("ðŸš¨ Could not get a token from server!")}})()}))}),[t]);const v=()=>{const{0:e,1:t}=(0,o.useState)([]);let n=null,l=0;return(0,o.useEffect)((()=>{const e=()=>{n&&n.close(),n=new WebSocket("wss://"+a+"/ws/"),n.onopen=()=>{console.log("âœ… WebSocket connected"),l=0},n.onmessage=e=>{try{const n=JSON.parse(e.data);console.log("ðŸ“© New message:",n),t((e=>[].concat((0,r.Z)(e),[n])))}catch(n){console.error("âŒ Failed to parse WebSocket message:",n)}},n.onerror=e=>{console.error("âŒ WebSocket Error:",e)},n.onclose=()=>{console.log("ðŸ”´ WebSocket disconnected. Reconnecting..."),l++;let t=Math.min(5e3*l,3e4);setTimeout(e,t)}};return e(),()=>{n&&n.close()}}),[]),o.createElement("div",null,o.createElement("h2",null,"Incoming SMS:"),o.createElement("ul",null,e.map(((e,t)=>{var n;return o.createElement("li",{key:t},null!==(n=null==e?void 0:e.message)&&void 0!==n?n:JSON.stringify(e))}))))};return t?o.createElement("div",{style:{padding:"1.5rem",backgroundColor:"#1a1a1a",color:"white",minHeight:"100vh"}},o.createElement("h1",{style:{fontSize:"1.5rem",marginBottom:"1rem"}},"Twilio Client"),o.createElement(v,null),o.createElement("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Enter a phone #",style:{padding:"0.5rem",borderRadius:"4px",backgroundColor:"#333",color:"white",width:"100%"}}),o.createElement("button",{onClick:async()=>{try{const e=await t.getIdToken(),n=await fetch("https://"+a+"/api/make-call",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({to:d})}),o=await n.json();if(!n.ok)throw new Error(o.error||"Failed to make call");console.log("ðŸ“ž Calling "+d+"...")}catch(e){console.log("âš ï¸ Call error: "+e.message)}},disabled:i,style:{backgroundColor:"green",padding:"0.5rem",borderRadius:"4px",width:"100%",marginTop:"0.5rem"}},"Call"),o.createElement("button",{onClick:()=>{l&&(console.log("ðŸ”´ Hanging up..."),l.disconnectAll())},disabled:!i,style:{backgroundColor:"red",padding:"0.5rem",borderRadius:"4px",width:"100%",marginTop:"0.5rem"}},"Hang Up"),p&&o.createElement(o.Fragment,null,o.createElement("h2",null,"Incoming Call"),o.createElement("button",{onClick:()=>{p&&(console.log("âœ… Answering call..."),p.accept(),s(!0))},style:{backgroundColor:"blue",padding:"0.5rem",borderRadius:"4px",width:"100%",marginTop:"0.5rem"}},"Answer Call"),o.createElement("button",{onClick:()=>{p&&(console.log("âŒ Rejecting call..."),p.reject(),h(null))},style:{backgroundColor:"gray",padding:"0.5rem",borderRadius:"4px",width:"100%",marginTop:"0.5rem"}},"Reject Call")),o.createElement("h2",null,"Send SMS"),o.createElement("input",{type:"text",value:S,onChange:e=>w(e.target.value),placeholder:"Enter SMS message",style:{padding:"0.5rem",borderRadius:"4px",backgroundColor:"#333",color:"white",width:"100%"}}),o.createElement("button",{onClick:async()=>{try{const e=await t.getIdToken(),n=await fetch("https://"+a+"/api/send-sms",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({to:d,message:S})}),o=await n.json();if(!n.ok)throw new Error(o.error||"Failed to send SMS");k((e=>[].concat((0,r.Z)(e),["Sent: "+S+" to "+d]))),w("")}catch(e){console.log("âŒ SMS Error: "+e.message)}},style:{backgroundColor:"blue",padding:"0.5rem",borderRadius:"4px",width:"100%",marginTop:"0.5rem"}},"Send SMS"),o.createElement("h2",null,"Incoming SMS"),o.createElement("div",{style:{backgroundColor:"#333",padding:"1rem",borderRadius:"4px",maxHeight:"12rem",overflowY:"auto"}})):o.createElement(o.Fragment,null,"not logged in")},c=n(8526),i=()=>o.createElement(c.Z,null,(e=>o.createElement(l,{user:e})))}}]);
//# sourceMappingURL=component---src-pages-index-2-tsx-79abf7b93615f34e0895.js.map